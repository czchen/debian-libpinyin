From: YunQiang Su <wzssyqa@gmail.com>
Date: Sat, 26 May 2012 09:34:40 +0800
Subject: fixes_test_flexible_ngram.cpp_kfreebsd_build

---
 src/pinyin_internal.h                 |    7 +++++++
 tests/storage/test_flexible_ngram.cpp |    6 +++---
 2 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/src/pinyin_internal.h b/src/pinyin_internal.h
index f1b0309..342ea6a 100644
--- a/src/pinyin_internal.h
+++ b/src/pinyin_internal.h
@@ -49,4 +49,11 @@
 using namespace pinyin;
 
 
+/* the following fixes build on Debian GNU/kFreeBSD */
+#include <errno.h>
+#ifndef ENODATA
+#define ENODATA ENOENT
+#endif
+
+
 #endif
diff --git a/tests/storage/test_flexible_ngram.cpp b/tests/storage/test_flexible_ngram.cpp
index 2f96906..0dcec67 100644
--- a/tests/storage/test_flexible_ngram.cpp
+++ b/tests/storage/test_flexible_ngram.cpp
@@ -12,7 +12,7 @@ int main(int argc, char * argv[]) {
 
     guint32 freq;
 
-    for ( size_t i = 0; i < 6; ++i ){
+    for ( size_t i = 0; i < G_N_ELEMENTS(tokens); ++i ){
         if ( single_gram.get_array_item(tokens[i], freq) )
             assert(single_gram.set_array_item(tokens[i], freqs[i]));
         else
@@ -74,7 +74,7 @@ int main(int argc, char * argv[]) {
     printf("magic header:%d\n", freq);
 
     printf("-----------------------array header---------------------\n");
-    for ( size_t i = 1; i <= 2; ++i){
+    for ( int i = 1; i <= 2; ++i){
         bigram.get_array_header(i, freq);
         printf("single gram: %d, freq:%d\n", i, freq);
     }
@@ -82,7 +82,7 @@ int main(int argc, char * argv[]) {
     bigram.set_array_header(1, 1);
 
     printf("-----------------------array header---------------------\n");
-    for ( size_t i = 1; i <= 2; ++i){
+    for ( int i = 1; i <= 2; ++i){
         bigram.get_array_header(i, freq);
         printf("single gram: %d, freq:%d\n", i, freq);
     }
